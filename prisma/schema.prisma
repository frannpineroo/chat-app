generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              Int              @id @default(autoincrement()) @map("id_users")
  nombre       String           @map("first_name") @db.VarChar(45)
  apellido        String           @map("last_name") @db.VarChar(45)
  email           String           @unique @db.VarChar(80)
  contra        String           @db.VarChar(45)
  isOnline        Boolean          @default(false) @map("is_online")
  isActive        Boolean          @default(true) @map("is_active")
  createdAt       DateTime         @default(now()) @map("created_at")

  mensajes        Mensaje[]
  chatMiembros    ChatMiembro[]
  notificaciones  Notificacion[]
  rolesUsuario    UsuarioRol[]

  @@map("usuarios")
}

model Chat {
  id            Int           @id @default(autoincrement()) @map("id_chat")
  nombreChat      String        @map("name_chats") @db.VarChar(45)
  isGroup       Boolean       @default(false) @map("is_group")
  isModerated   Boolean       @default(false) @map("is_moderated")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("update_at")
  
  miembros      ChatMiembro[]
  mensajes      Mensaje[]

  @@map("chats")
}

model ChatMiembro {
  id            Int       @id @default(autoincrement()) @map("id_chat_member")
  usuarioId        Int       @map("users_id_users")
  chatId        Int       @map("chats_id_chat")
  canWrite      Boolean   @default(true) @map("can_write")
  joinedAt      DateTime  @default(now()) @map("joined_at")
  isModerator   Boolean   @default(false) @map("is_moderator")
  
  usuario       Usuario   @relation(fields: [usuarioId], references: [id])
  chats         Chat      @relation(fields: [chatId], references: [id])

  @@map("chat_miembros")
}

model Mensaje {
  id            Int       @id @default(autoincrement()) @map("id_message")
  info          String    @db.VarChar(1000)
  tipMensaje    String    @default("text") @map("message_type") @db.VarChar(45)
  enviadoEn     DateTime  @default(now()) @map("sent_at")
  arhivado      Boolean   @default(false) @map("is_archived")
  leido         Boolean   @default(false) @map("is_read")
  chatId        Int       @map("chats_id_chat")
  userId        Int       @map("users_id_users")
  
  chat          Chat      @relation(fields: [chatId], references: [id])
  usuario       Usuario   @relation(fields: [userId], references: [id])

  @@map("mensajes")
}

model Rol {
  id            Int           @id @default(autoincrement()) @map("id_roles")
  nombreRol      String        @map("name_roles") @db.VarChar(45)
  
  usuariosRol   UsuarioRol[]

  @@map("roles")
}

model UsuarioRol {
  usuarioId        Int       @map("users_id_users")
  rolId        Int       @map("roles_id_roles")
  
  usuario       Usuario   @relation(fields: [usuarioId], references: [id])
  rol           Rol       @relation(fields: [rolId], references: [id])

  @@id([usuarioId, rolId])
  @@map("user_roles")
}

model Notificacion {
  id            Int       @id @default(autoincrement()) @map("id_notification")
  mensaje       String    @db.VarChar(45)
  creadoEn     DateTime  @default(now()) @map("created_at")
  pendiente     Boolean   @default(true) @map("is_pending")
  usuarioId        Int       @map("users_id_users")
  
  usuario       Usuario   @relation(fields: [usuarioId], references: [id])

  @@map("notificaciones")
}